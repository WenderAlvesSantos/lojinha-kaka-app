<div class="container">
  <!-- Header com t√≠tulo e busca -->
  <header class="products-header">
    <h1 class="page-title">üçé Nossos Produtos</h1>
    <p class="page-subtitle">Encontre a fruta perfeita para voc√™</p>
    
    <!-- Barra de busca -->
    <div class="search-container">
      <div class="search-box">
        <span class="search-icon">üîç</span>
        <input 
          type="text" 
          class="search-input"
          placeholder="Buscar por nome..."
          [ngModel]="searchTerm"
          (ngModelChange)="onSearchChange($event)"
        />
        <button 
          class="clear-search-btn"
          *ngIf="searchTerm"
          (click)="clearSearch()"
          type="button"
          aria-label="Limpar busca"
        >
          ‚úï
        </button>
      </div>
      <div class="results-count" *ngIf="(sortedProducts$ | async) as products">
        <span *ngIf="searchTerm">
          {{ products.length }} produto{{ products.length !== 1 ? 's' : '' }} encontrado{{ products.length !== 1 ? 's' : '' }}
        </span>
      </div>
    </div>
  </header>

  <!-- Controles de ordena√ß√£o e informa√ß√µes -->
  <div class="controls-bar" *ngIf="(sortedProducts$ | async) as allProducts">
    <div class="sort-controls">
      <span class="sort-label">Ordenar por:</span>
      <button 
        class="sort-btn"
        [class.active]="sortField === 'nome'"
        (click)="setSortField('nome')"
        type="button"
      >
        Nome {{ getSortIcon('nome') }}
      </button>
      <button 
        class="sort-btn"
        [class.active]="sortField === 'preco'"
        (click)="setSortField('preco')"
        type="button"
      >
        Pre√ßo {{ getSortIcon('preco') }}
      </button>
      <button 
        class="sort-btn"
        [class.active]="sortField === 'estoque'"
        (click)="setSortField('estoque')"
        type="button"
      >
        Estoque {{ getSortIcon('estoque') }}
      </button>
    </div>
    
    <div class="pagination-info" *ngIf="totalItems > 0">
      <span *ngIf="currentPage$ | async as page">
        Mostrando {{ (page - 1) * itemsPerPage + 1 }} - 
        {{ Math.min(page * itemsPerPage, totalItems) }} 
        de {{ totalItems }} produto{{ totalItems !== 1 ? 's' : '' }}
      </span>
    </div>
  </div>

  <!-- Grid de produtos -->
  <section class="grid" *ngIf="(paginatedProducts$ | async) as products">
    <!-- Mensagem quando n√£o h√° resultados -->
    <div class="no-results" *ngIf="products.length === 0">
      <div class="no-results-icon">üîç</div>
      <h3>Nenhum produto encontrado</h3>
      <p>Tente buscar com outro termo</p>
      <button class="clear-search-link" (click)="clearSearch()" *ngIf="searchTerm">
        Limpar busca
      </button>
    </div>

    <!-- Cards de produtos -->
    <div 
      class="card" 
      *ngFor="let product of products"
      (click)="openBuyModal(product)"
      [class.out-of-stock]="product.qtd === 0"
    >
      <div class="card-image-wrapper">
        <img [src]="product.imagem" [alt]="product.nome" class="product-image" />
        <div class="stock-badge" [class.in-stock]="product.qtd > 0" [class.out-stock]="product.qtd === 0">
          <span *ngIf="product.qtd > 0">{{ product.qtd }} em estoque</span>
          <span *ngIf="product.qtd === 0">Esgotado</span>
        </div>
      </div>
      
      <div class="card-content">
        <h2 class="product-name">{{ product.nome }}</h2>
        <div class="product-price">{{ product.preco }}</div>
        <div class="card-footer">
          <button 
            class="buy-button"
            *ngIf="product.qtd > 0"
            (click)="openBuyModal(product); $event.stopPropagation()"
          >
            <span class="buy-icon">üõí</span>
            Comprar
          </button>
          <div class="out-of-stock-message" *ngIf="product.qtd === 0">
            Produto indispon√≠vel
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Controles de pagina√ß√£o -->
  <div class="pagination-container" *ngIf="totalPages$ | async as totalPages">
    <ng-container *ngIf="totalPages > 1">
      <div class="pagination" *ngIf="currentPage$ | async as currentPage">
        <button 
          class="pagination-btn"
          [class.disabled]="currentPage === 1"
          (click)="previousPage()"
          type="button"
          [disabled]="currentPage === 1"
        >
          ‚Üê Anterior
        </button>
        
        <div class="page-numbers" *ngIf="pageNumbers$ | async as pageNumbers">
          <button 
            *ngFor="let page of pageNumbers"
            class="page-btn"
            [class.active]="currentPage === page"
            (click)="goToPage(page)"
            type="button"
          >
            {{ page }}
          </button>
        </div>
        
        <button 
          class="pagination-btn"
          [class.disabled]="currentPage === totalPages"
          (click)="nextPage()"
          type="button"
          [disabled]="currentPage === totalPages"
        >
          Pr√≥xima ‚Üí
        </button>
      </div>
    </ng-container>
  </div>

  <!-- Modal de Compra -->
  <div class="modal-overlay" *ngIf="showBuyModal" (click)="closeBuyModal()">
    <div class="modal-box" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="closeBuyModal()">√ó</button>
      
      <div class="product-preview" *ngIf="selectedProduct">
        <img [src]="selectedProduct.imagem" [alt]="selectedProduct.nome" />
        <h2>{{ selectedProduct.nome }}</h2>
        <p class="price-display">{{ selectedProduct.preco }}</p>
        <p class="stock-info">{{ selectedProduct.qtd }} unidades dispon√≠veis</p>
      </div>

      <div class="quantity-selector">
        <label>Quantidade:</label>
        <div class="quantity-controls">
          <button 
            type="button" 
            class="qty-btn" 
            (click)="decrementQuantity()"
            [disabled]="quantity <= 1"
          >
            -
          </button>
          <input 
            type="number" 
            [(ngModel)]="quantity" 
            min="1" 
            [max]="selectedProduct?.qtd || 1"
            readonly
          />
          <button 
            type="button" 
            class="qty-btn" 
            (click)="incrementQuantity()"
            [disabled]="quantity >= (selectedProduct?.qtd || 1)"
          >
            +
          </button>
        </div>
      </div>

      <div class="modal-actions">
        <button class="cancel-btn" (click)="closeBuyModal()">
          Cancelar
        </button>
        <button class="whatsapp-btn" (click)="confirmPurchase()">
          <span class="whatsapp-icon">üí¨</span>
          Comprar via WhatsApp
        </button>
      </div>
    </div>
  </div>
</div>
