<div class="admin-container">
  <header>
    <h1>Painel Admin - Estoque</h1>
    <button *ngIf="isAuthenticated" class="logout-btn" (click)="logout()">Sair</button>
  </header>

  <!-- Login Overlay -->
  <div class="login-overlay" *ngIf="!isAuthenticated">
    <div class="login-box">
      <h2>√Årea Administrativa</h2>
      
      <input
        type="text"
        [(ngModel)]="username"
        placeholder="Usu√°rio"
        (keydown.enter)="login()"
      />
      
      <input
        type="password"
        [(ngModel)]="password"
        placeholder="Senha"
        (keydown.enter)="login()"
        autofocus
      />
      
      <button (click)="login()">Entrar</button>
      
      <div class="error" *ngIf="loginError">{{ loginError }}</div>
    </div>
  </div>

  <!-- Main Content -->
  <main *ngIf="isAuthenticated">
    <div class="toolbar">
      <button class="add-btn" (click)="openAddProductModal()">
        + Adicionar Produto
      </button>
      <button class="reset-btn" (click)="resetDefaults()">
        Resetar Estoque Padr√£o
      </button>
    </div>

    <div class="cards-container">
      <div class="card" *ngFor="let product of products$ | async">
        <button 
          class="delete-product-btn" 
          (click)="deleteProduct(product.id, product.nome)"
          title="Deletar produto"
        >
          √ó
        </button>
        <h3>{{ product.nome }}</h3>
        <span class="qty">Quantidade: {{ product.qtd }}</span>
        <div class="controls">
          <button 
            class="plus" 
            (click)="increment(product.id)"
            [attr.aria-label]="'Aumentar ' + product.nome"
          >
            +
          </button>
          <button 
            class="minus" 
            (click)="decrement(product.id)"
            [attr.aria-label]="'Diminuir ' + product.nome"
          >
            -
          </button>
        </div>
      </div>
    </div>

    <footer>
      Mudan√ßas salvas no banco de dados.
    </footer>
  </main>

  <!-- Modal Adicionar Produto -->
  <div class="modal-overlay" *ngIf="showAddProductModal" (click)="closeAddProductModal()">
    <div class="modal-box" (click)="$event.stopPropagation()">
      <h2>Adicionar Novo Produto</h2>
      
      <form (ngSubmit)="addProduct()">
        <div class="form-group">
          <label for="productId">ID do Produto *</label>
          <input
            id="productId"
            type="text"
            [(ngModel)]="newProduct.id"
            name="id"
            placeholder="ex: dragon"
            required
          />
          <small>Ser√° formatado automaticamente (min√∫sculo, sem espa√ßos)</small>
        </div>

        <div class="form-group">
          <label for="productName">Nome *</label>
          <input
            id="productName"
            type="text"
            [(ngModel)]="newProduct.nome"
            name="nome"
            placeholder="ex: Dragon"
            required
          />
        </div>

        <div class="form-group">
          <label for="productQty">Quantidade Inicial</label>
          <input
            id="productQty"
            type="number"
            [(ngModel)]="newProduct.qtd"
            name="qtd"
            placeholder="0"
            min="0"
          />
        </div>

        <div class="form-group">
          <label for="productPrice">Pre√ßo *</label>
          <input
            id="productPrice"
            type="text"
            [(ngModel)]="newProduct.preco"
            name="preco"
            placeholder="ex: R$25,00"
            required
          />
        </div>

        <div class="form-group">
          <label for="productImage">Imagem do Produto</label>
          
          <div class="upload-options">
            <div class="upload-tab">
              <input
                type="file"
                id="imageFile"
                accept="image/*"
                (change)="onFileSelected($event)"
                [disabled]="uploadingImage"
              />
              <label for="imageFile" class="file-label">
                <span *ngIf="!selectedFile">üìÅ Escolher Arquivo</span>
                <span *ngIf="selectedFile">‚úì {{ selectedFile.name }}</span>
              </label>
            </div>
            
            <div class="or-divider">OU</div>
            
            <input
              id="productImage"
              type="text"
              [(ngModel)]="newProduct.imagem"
              name="imagem"
              placeholder="URL da imagem ou nome do arquivo local"
              [disabled]="selectedFile !== null"
            />
          </div>
          
          <small *ngIf="!selectedFile">
            Fa√ßa upload de uma imagem ou digite URL/nome do arquivo local
          </small>
          <small *ngIf="selectedFile">
            Arquivo selecionado. Ser√° enviado ao clicar em "Adicionar Produto"
          </small>
        </div>

        <div class="error" *ngIf="addProductError">{{ addProductError }}</div>

        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="closeAddProductModal()" [disabled]="uploadingImage">
            Cancelar
          </button>
          <button type="submit" class="submit-btn" [disabled]="uploadingImage">
            <span *ngIf="!uploadingImage">Adicionar Produto</span>
            <span *ngIf="uploadingImage">Enviando imagem...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
