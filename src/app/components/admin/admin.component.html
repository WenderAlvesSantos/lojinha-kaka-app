<div class="admin-container">
  <!-- Login Overlay -->
  <div class="login-overlay" *ngIf="!isAuthenticated">
    <div class="login-box">
      <div class="login-header">
        <div class="login-icon">üîê</div>
        <h2>√Årea Administrativa</h2>
        <p class="login-subtitle">Fa√ßa login para gerenciar o estoque</p>
      </div>
      
      <form (ngSubmit)="login()">
        <div class="input-group">
          <label for="username">Usu√°rio</label>
          <input
            id="username"
            type="text"
            [(ngModel)]="username"
            name="username"
            placeholder="Digite seu usu√°rio"
            (keydown.enter)="login()"
            autocomplete="username"
          />
        </div>
        
        <div class="input-group">
          <label for="password">Senha</label>
          <input
            id="password"
            type="password"
            [(ngModel)]="password"
            name="password"
            placeholder="Digite sua senha"
            (keydown.enter)="login()"
            autocomplete="current-password"
            autofocus
          />
        </div>
        
        <div class="error-message" *ngIf="loginError">
          <span class="error-icon">‚ö†Ô∏è</span>
          {{ loginError }}
        </div>
        
        <button type="submit" class="login-btn">
          <span>Entrar</span>
          <span class="btn-arrow">‚Üí</span>
        </button>
      </form>
    </div>
  </div>

  <!-- Main Content -->
  <main *ngIf="isAuthenticated">
    <!-- Header -->
    <header class="admin-header">
      <div class="header-content">
        <div class="header-title">
          <h1>üìä Painel Administrativo</h1>
          <p class="header-subtitle">Gerenciamento de Estoque</p>
        </div>
        <button class="logout-btn" (click)="logout()">
          <span class="logout-icon">üö™</span>
          Sair
        </button>
      </div>
    </header>

    <!-- Estat√≠sticas -->
    <section class="stats-section">
      <div class="stat-card stat-primary">
        <div class="stat-icon-wrapper">
          <div class="stat-icon">üì¶</div>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ totalProducts }}</div>
          <div class="stat-label">Total de Produtos</div>
          <div class="stat-trend">Cadastrados no sistema</div>
        </div>
        <div class="stat-decoration"></div>
      </div>
      
      <div class="stat-card stat-info">
        <div class="stat-icon-wrapper">
          <div class="stat-icon">üìä</div>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ totalStock }}</div>
          <div class="stat-label">Estoque Total</div>
          <div class="stat-trend">Unidades dispon√≠veis</div>
        </div>
        <div class="stat-decoration"></div>
      </div>
      
      <div class="stat-card stat-warning" *ngIf="outOfStockCount > 0">
        <div class="stat-icon-wrapper">
          <div class="stat-icon">‚ö†Ô∏è</div>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ outOfStockCount }}</div>
          <div class="stat-label">Produtos Esgotados</div>
          <div class="stat-trend">Requer aten√ß√£o</div>
        </div>
        <div class="stat-decoration"></div>
      </div>
      
      <div class="stat-card stat-success" *ngIf="outOfStockCount === 0 && totalProducts > 0">
        <div class="stat-icon-wrapper">
          <div class="stat-icon">‚úÖ</div>
        </div>
        <div class="stat-content">
          <div class="stat-value">100%</div>
          <div class="stat-label">Estoque Completo</div>
          <div class="stat-trend">Todos os produtos dispon√≠veis</div>
        </div>
        <div class="stat-decoration"></div>
      </div>
    </section>

    <!-- Toolbar -->
    <div class="toolbar">
      <div class="search-container">
        <div class="search-box">
          <span class="search-icon">üîç</span>
          <input 
            type="text" 
            class="search-input"
            placeholder="Buscar produto por nome ou ID..."
            [ngModel]="searchTerm"
            (ngModelChange)="onSearchChange($event)"
          />
          <button 
            class="clear-search-btn"
            *ngIf="searchTerm"
            (click)="clearSearch()"
            type="button"
            aria-label="Limpar busca"
          >
            ‚úï
          </button>
        </div>
        <div class="search-results" *ngIf="(filteredProducts$ | async) as products">
          <span *ngIf="searchTerm">
            {{ products.length }} produto{{ products.length !== 1 ? 's' : '' }} encontrado{{ products.length !== 1 ? 's' : '' }}
          </span>
        </div>
      </div>
      
      <div class="toolbar-actions">
        <button class="add-btn" (click)="openAddProductModal()">
          <span class="btn-icon">‚ûï</span>
          Adicionar Produto
        </button>
        <button class="reset-btn" (click)="resetDefaults()">
          <span class="btn-icon">üîÑ</span>
          Resetar Estoque
        </button>
      </div>
    </div>

    <!-- Products Table -->
    <div class="table-container">
      <table class="products-table">
        <thead>
          <tr>
            <th class="product-column">Produto</th>
            <th class="stock-column">Estoque</th>
            <th class="price-column">Pre√ßo</th>
            <th class="actions-column">A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of filteredProducts$ | async" [class.out-of-stock]="product.qtd === 0">
            <td class="product-cell">
              <div class="product-info">
                <div class="product-image-wrapper">
                  <img [src]="product.imagem" [alt]="product.nome" class="product-image" />
                  <div class="image-overlay" *ngIf="product.qtd === 0">
                    <span>Esgotado</span>
                  </div>
                </div>
                <div class="product-details">
                  <div class="product-name">{{ product.nome }}</div>
                  <div class="product-id">
                    <span class="id-label">ID:</span>
                    <span class="id-value">{{ product.id }}</span>
                  </div>
                </div>
              </div>
            </td>
            <td class="stock-cell">
              <div class="stock-display">
                <div class="stock-header">
                  <span class="stock-value" [class.zero]="product.qtd === 0">{{ product.qtd }}</span>
                  <span class="stock-label">unidades</span>
                </div>
                <div class="stock-bar">
                  <div class="stock-bar-fill" [style.width.%]="product.qtd > 0 ? 100 : 0" [class.zero]="product.qtd === 0"></div>
                </div>
                <div class="stock-status" [class.warning]="product.qtd === 0">
                  <span *ngIf="product.qtd === 0">‚ö†Ô∏è Sem estoque</span>
                  <span *ngIf="product.qtd > 0 && product.qtd <= 3">‚ö†Ô∏è Estoque baixo</span>
                  <span *ngIf="product.qtd > 3">‚úì Em estoque</span>
                </div>
              </div>
            </td>
            <td class="price-cell">
              <div class="price-display">
                <span class="price-value">{{ product.preco }}</span>
              </div>
            </td>
            <td class="actions-cell">
              <div class="action-buttons">
                <button 
                  class="action-btn increment-btn" 
                  (click)="increment(product.id)"
                  [attr.aria-label]="'Aumentar estoque de ' + product.nome"
                  title="Aumentar estoque"
                >
                  <span>+</span>
                </button>
                <button 
                  class="action-btn decrement-btn" 
                  (click)="decrement(product.id)"
                  [attr.aria-label]="'Diminuir estoque de ' + product.nome"
                  title="Diminuir estoque"
                  [disabled]="product.qtd === 0"
                >
                  <span>‚àí</span>
                </button>
                <button 
                  class="action-btn delete-btn" 
                  (click)="deleteProduct(product.id, product.nome)"
                  [attr.aria-label]="'Deletar ' + product.nome"
                  title="Deletar produto"
                >
                  <span>üóëÔ∏è</span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      
      <div class="empty-state" *ngIf="(filteredProducts$ | async) as products">
        <div *ngIf="products.length === 0 && !searchTerm" class="empty-content">
          <div class="empty-icon">üì¶</div>
          <h3>Nenhum produto cadastrado</h3>
          <p>Comece adicionando seu primeiro produto</p>
          <button class="add-btn" (click)="openAddProductModal()">
            <span class="btn-icon">‚ûï</span>
            Adicionar Primeiro Produto
          </button>
        </div>
        <div *ngIf="products.length === 0 && searchTerm" class="empty-search">
          <div class="empty-icon">üîç</div>
          <h3>Nenhum produto encontrado</h3>
          <p>Tente buscar com outro termo</p>
          <button class="clear-search-link" (click)="clearSearch()">
            Limpar busca
          </button>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="admin-footer">
      <div class="footer-content">
        <span class="footer-icon">üíæ</span>
        <span>Mudan√ßas s√£o salvas automaticamente no banco de dados</span>
      </div>
    </footer>
  </main>

  <!-- Modal Adicionar Produto -->
  <div class="modal-overlay" *ngIf="showAddProductModal" (click)="closeAddProductModal()">
    <div class="modal-box" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>‚ûï Adicionar Novo Produto</h2>
        <button class="modal-close-btn" (click)="closeAddProductModal()" type="button" [disabled]="uploadingImage">
          √ó
        </button>
      </div>
      
      <form (ngSubmit)="addProduct()">
        <div class="form-group">
          <label for="productId">
            ID do Produto <span class="required">*</span>
          </label>
          <input
            id="productId"
            type="text"
            [(ngModel)]="newProduct.id"
            name="id"
            placeholder="ex: dragon"
            required
            [disabled]="uploadingImage"
          />
          <small>Ser√° formatado automaticamente (min√∫sculo, sem espa√ßos)</small>
        </div>

        <div class="form-group">
          <label for="productName">
            Nome do Produto <span class="required">*</span>
          </label>
          <input
            id="productName"
            type="text"
            [(ngModel)]="newProduct.nome"
            name="nome"
            placeholder="ex: Dragon"
            required
            [disabled]="uploadingImage"
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="productQty">Quantidade Inicial</label>
            <input
              id="productQty"
              type="number"
              [(ngModel)]="newProduct.qtd"
              name="qtd"
              placeholder="0"
              min="0"
              [disabled]="uploadingImage"
            />
          </div>

          <div class="form-group">
            <label for="productPrice">
              Pre√ßo <span class="required">*</span>
            </label>
            <input
              id="productPrice"
              type="text"
              [(ngModel)]="newProduct.preco"
              name="preco"
              placeholder="ex: R$25,00"
              required
              [disabled]="uploadingImage"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="productImage">Imagem do Produto</label>
          
          <div class="upload-options">
            <div class="upload-tab">
              <input
                type="file"
                id="imageFile"
                accept="image/*"
                (change)="onFileSelected($event)"
                [disabled]="uploadingImage || newProduct.imagem"
              />
              <label for="imageFile" class="file-label" [class.has-file]="selectedFile">
                <span class="upload-icon">üìÅ</span>
                <span *ngIf="!selectedFile">Escolher Arquivo</span>
                <span *ngIf="selectedFile" class="file-name">‚úì {{ selectedFile.name }}</span>
              </label>
            </div>
            
            <div class="or-divider">
              <span>OU</span>
            </div>
            
            <input
              id="productImage"
              type="text"
              [(ngModel)]="newProduct.imagem"
              name="imagem"
              placeholder="URL da imagem ou nome do arquivo local"
              [disabled]="selectedFile !== null || uploadingImage"
            />
          </div>
          
          <small *ngIf="!selectedFile && !newProduct.imagem">
            Fa√ßa upload de uma imagem ou digite URL/nome do arquivo local
          </small>
          <small *ngIf="selectedFile" class="file-info">
            Arquivo selecionado. Ser√° enviado ao clicar em "Adicionar Produto"
          </small>
        </div>

        <div class="error-message" *ngIf="addProductError">
          <span class="error-icon">‚ö†Ô∏è</span>
          {{ addProductError }}
        </div>

        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="closeAddProductModal()" [disabled]="uploadingImage">
            Cancelar
          </button>
          <button type="submit" class="submit-btn" [disabled]="uploadingImage">
            <span *ngIf="!uploadingImage">
              <span class="btn-icon">‚úì</span>
              Adicionar Produto
            </span>
            <span *ngIf="uploadingImage" class="loading">
              <span class="spinner"></span>
              Enviando imagem...
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
